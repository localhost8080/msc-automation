#!/usr/bin/env python
import sys
import os
import subprocess

def main():
	__location__ = os.path.realpath(
	    os.path.join(os.getcwd(), os.path.dirname(__file__)))

	authenticate = subprocess.Popen(os.path.join(__location__,'authenticate-dvwa'), stdout=subprocess.PIPE)

	with open(os.path.join(__location__,'urllist.txt')) as urlfile:
		for url in urlfile:
			print url
			scanner = subprocess.Popen(['arachni', '--http-cookie-jar', 'cookie.txt', '--scope-page-limit 1', _url], stdout=subprocess.PIPE)
			output = scanner.stdout.readlines()
			if 'str' in url:
				break

	cleanup = subprocess.Popen(os.path.join(__location__,'cleanup'), stdout=subprocess.PIPE)

if __name__ == '__main__':
	main()
